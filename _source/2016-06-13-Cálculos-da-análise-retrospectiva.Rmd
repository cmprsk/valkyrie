---
layout: post
title:  "Cálculos da análise retrospectiva"
date:   2016-06-13 16:03:45 -0300
categories: metodologia
---

## Curva de sobrevida da análise retrospectiva:

Os cálculos mostrados aqui usam o banco de dados de pacientes diagnosticados com DIPG entre 2000-2013, atualizados até 2014. O follow-up dos pacientes neste banco de dados é um pouco mais longo que nos dados originalmente usados para os cálculos do projeto e, portanto, terão algumas diferenças numéricas. Esta postagem ilustra como usar os dados obtidos de uma pesquisa clínica de forma transparente e totalmente reprodutível aos leitores. Incluindo tanto os dados de pacientes individuais (sem identificá-los) como o _script_ usado para realizar a análise dos dados, este é um exemplo das possibilidades do modelo de _open lab notebook_ e do paradigma de _open science_. Quando os dados do ensaio prospectivo forem coletados, serão igualmente publicados da mesma forma transparente, ficando permanentemente disponíveis para análise e crítica pelos interessados. Discuti a inspiração para esta abordagem nesta [postagem](http://fhcflx.github.io/pharmakon/jekyll/update/2016/05/01/Migrando-meu-blog-para-Github-Pages-usando-Jekyll.html) em outro blog.

Esta postagem usa o pacote [_knitr_](http://yihui.name/knitr/) para calcular os resultados ao mesmo tempo em que compila a página em html com [_jekyll_](https://jekyllrb.com/).
Utilizei, como guia, o excelente exemplo de [_yihui_](https://github.com/yihui/knitr).

```{r warning=F, message=F}
require(knitr)
require(RCurl)
require(survival)
dipg<-read.csv(text = getURL("https://raw.githubusercontent.com/fhcflx/valkyrie/gh-pages/assets/data/dipg.csv"))
attach(dipg)  
fit1 = survfit(Surv(surv,status)~1)  
fit2 = survfit(Surv(surv,ifelse(status<1,1,0))~1)  
fit3 = survfit(Surv(surv,status)~ifelse(QT1<10,0,1))  
```

```{r Sobrevida, fig.height=10, fig.width=12, fig.cap='Sobrevida de pacientes com DIPG'}
plot(fit1,xlab="Meses")
```

Grupo de pacientes com diagnóstico de DIPG tratados em nosso serviço, entre 2000 e 2013. O gráfico mostra a estimativa de probabilidade de sobrevida, calculada pelo método de Kaplan-Meier, usando a linguagem de programação R, pacote *survival*. O pacote *RCurl* foi adicionalmente utilizado para capturar os dados a partir do arquivo [.csv](https://github.com/fhcflx/valkyrie/blob/gh-pages/assets/stat/dipg.csv) armazenado no repositório do github. O gráfico mostra também o intervalo de confiança 95%.
Este é o resumo da variável de sobrevida, além da sobrevida em 12 meses e tempo de follow-up:

```{r echo=F}
fit1
```

```{r echo=F}
summary(fit1,time=12)
```

Mostrando uma mediana de sobrevida de `r round(summary(fit1)$table[7],1)` meses e sobrevida em 12 meses de `r round(summary(fit1,time=12)$surv,3)*100` %.

```{r echo=F}
fit2
```

Mostrando uma mediana de follow-up de `r round(summary(fit2)$table[7],1)` meses.

Aqui, o gráfico comparativo entre os pacientes que fizeram QT segundo um esquema HIT e os outros pacientes:

```{r Sobrevida2, fig.height=10, fig.width=12, fig.cap='Sobrevida de pacientes com DIPG, divididos por tratamento'}
plot(fit3,xlab="Meses")
```
E o resumo da sobrevida nos 2 grupos, com sobrevida aos 12 meses:
```{r echo=F}
fit3
```
```{r echo=F}
summary(fit3,time=12)
```

Mostrando uma sobrevida aos 12 meses de `r round(summary(fit3,time=12)$surv[2],3)*100` % para o grupo tratado com protocolo _as per_ HIT (n = `r summary(fit3,time=12)$n[2]` ) e de `r round(summary(fit3,time=12)$surv[1],3)*100` % para os demais (n = `r summary(fit3,time=12)$n[1]` ).

Comparando os dois grupos com um teste não paramétrico que utiliza o estimador de Kaplan-Meier, o teste de log-rank, ou de Mantel-Haenszel (vide documentação do pacote [_survival_](https://cran.r-project.org/web/packages/survival/survival.pdf)).
```{r echo=F}
survdiff(Surv(surv,status)~ifelse(QT1<10,0,1),dipg)
```
Comparando os dois grupos com um teste semiparamétrico, o modelo de riscos proporcionais de Cox (vide documentação do pacote [_survival_](https://cran.r-project.org/web/packages/survival/survival.pdf)).
```{r echo=F}
summary(coxph(Surv(surv,status)~ifelse(QT1<10,0,1),dipg))
```
Este resultado indica que existe a possibilidade de haver alguma diferença de sobrevida quando os pacientes recebem ácido valpróico juntamente com o tratamento.
